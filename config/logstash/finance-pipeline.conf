# Configuration for Finance Pipeline
# Configuration for Sales Pipeline
input {
  file {
    path => "/data/sales/*.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    codec => plain { charset => "UTF-8" }
  }
}

filter {
  csv {
    separator => ","
    columns => ["unit_price", "total_amount", "payment_method", "quantity"]
    skip_header => true
  }
  
  mutate {
    convert => {
      "quantity" => "integer"
      "unit_price" => "float"
      "total_price" => "float"
    }
    rename => {
      "date" => "sale_date"
    }
  }
  
  date {
    match => ["sale_date", "yyyy-MM-dd"]
    target => "@timestamp"
  }
  
  translate {
    field => "region"
    destination => "region_fr"
    dictionary => {
      "Ile-de-France" => "Île-de-France"
      "Rhône-Alpes" => "Auvergne-Rhône-Alpes"
      "PACA" => "Provence-Alpes-Côte d'Azur"
    }
    fallback => "%{region}"
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "sales-data"
    document_type => "_doc"
  }

  stdout {
    codec => rubydebug
  }
}