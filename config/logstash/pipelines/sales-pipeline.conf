# Configuration for Sales Pipeline
input {
  tcp {
    port => 5044
    codec => json_lines
  }
  file {
    path => "/data/sales/sales_data.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    codec => plain { charset => "UTF-8" }
  }
}

filter {
  csv {
    separator => ","
    columns => ["date", "product_id", "product_name", "category", 
               "quantity", "unit_price", "total_price", "sales_rep",
               "region", "channel", "payment_method", "customer_segment"]
    skip_header => true
  }
  
  mutate {
    convert => {
      "quantity" => "integer"
      "unit_price" => "float"
      "total_price" => "float"
    }
    rename => {
      "date" => "sale_date"
    }
  }
  
  date {
    match => ["sale_date", "yyyy-MM-dd"]
    target => "@timestamp"
  }
  
  translate {
    field => "region"
    destination => "region_fr"
    dictionary => {
      "Ile-de-France" => "Île-de-France"
      "Rhône-Alpes" => "Auvergne-Rhône-Alpes"
      "PACA" => "Provence-Alpes-Côte d'Azur"
    }
    fallback => "%{region}"
  }
}

output {
  stdout {
    codec => rubydebug
  }
  file {
    path => "../../data/sales/json/sales-output.json"
    codec => "json_lines"
  }
}